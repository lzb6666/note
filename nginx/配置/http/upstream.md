upstream指定了一个上行的流，就是请求可以转发过去的地方。其中可以定义多个
转发主机及端口，这样就形成了内容的分发，负载均衡。  

## 分发方式（负载均衡算法）
对于分发的方式，常用的有下面几种：  

* weight，按权重分配，默认的weight为1，当所有权重都为1时，即轮询
* least_conn;最少连接算法，将请求分配给当前连接数最少的主机条目
* ip_hash;IPhash即将ip地址进行hash运算（防止聚集），再分配给主机条目，这
样能保证相同的ip地址请求被分发给同一个主机条目，可以从一定程度上解决分布
式环境下session共享的问题；
* least_time;最小响应时间，将请求分发给当前响应速度最快的主机条目；
* url_hash；需要使用第三方模块，能够将相同的url分发至相同的主机条目，当
使用其他模块或资源分散是可以使用

还有其他的一些负载均衡算法，如自定义hash，根据用户自定的变量结构进行hash，
随机分发，完全随机的进行分发。

## 主机条目
```
Syntax:	server address [parameters];
Default:	—
Context:	upstream
```
其中address应当包含端口，不指定则http默认80，https默认443；

关于参数常用的有：

| 参数 | 功能 |
|------|------|
|weight|轮询的权重|
|max_conns|最大连接数|
|fail_timeout|timeout判断时间|
|max_fails|不可用阈值|
|backup|备用主机条目|
|down|标记不可用|
